<!DOCTYPE html>
<html lang="en">

<head>
  <title>Onny</title>
  <meta charset="UTF-8" />
  <meta name="description" content="" />
  <meta name="author" content="dawtonico" />
  <meta name="robots" content="noindex, nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png"
    href="https://cdn.discordapp.com/attachments/1039517691242877008/1126258378742710333/download.png" />
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins" />
  <link rel="stylesheet" href="/css/w3.css">
  <link rel="stylesheet" href="/css/dashboard.css">
  <script src="/html/parceiros/codemanagement/app.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
  <script>
    window.addEventListener("contextmenu", function (e) {
      e.preventDefault();
    });

    window.addEventListener("keydown", function (e) {
      if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === "I") {
        e.preventDefault();
      }
    });

    window.addEventListener("keydown", function (e) {
      if ((e.ctrlKey || e.metaKey) && e.key === "u") {
        e.preventDefault();
      }
    });
    
    function verificarResolucao() {
      if (window.innerWidth <= 1450) {
        window.location.href = "/insupported";
      }
    }

    verificarResolucao();
    window.addEventListener("resize", verificarResolucao);
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
</head>

<body style="background-color: #2B2D31;">
  <div class="transition-screen" id="transition-screen">
    <div class="transition-screen-content">
      <i
        class="fas fa-torii-gate w3-text-white"
        style="animation: inflateLoad 2s infinite; margin-top: -30px;"
      ></i>
    </div>
  </div>

  <div id="hud" class="modalparceiros">
    <div class="modalparceiros-content">
      <h3 class="w3-text-white" style="margin-left: 10px; margin-right: 10px">
        Ação solicitada!
      </h3>
      <p
        id="guildsDescTitle"
        class="w3-text-grey"
        style="margin-top: -15px; margin-left: 10px; margin-right: 10px"
      >
        Como é uma aplicação de um servidor parceiro a solicitação é enviada e você deve receber através do discord. Mantenha suas mensagens privadas habilitadas!
      </p>

      <p id="lastMessages" class="w3-text-grey" style="background-color: #2B2D31; border-radius: 10px; padding: 20px;"></p>

      <button id="cancelLogout"
      class="w3-button w3-text-white"
      style="border-radius: 5px; background-color: #1e1f22; margin: 5px; width: auto;" onclick="closeHUDdatabase()">Fechar</button>
    </div>
  </div>

  <div id="safeBar" class="safe-bar">
    <p>Essa aplicação não faz parte dos dominios da Onny. Quaisquer problemas relacionados a aplicação deve ser tratado com o servidor parceiro!</p>
    <button id="closeButton">X</button>
  </div>

  <nav class="w3-sidebar w3-collapse w3-top w3-large w3-padding" style="z-index: 3; width: 100px; font-weight: bold"
    id="mySidebar"></nav>
  <div id="hud" class="w3-main slide-inx" style="margin-left: 140px; margin-right: 40px">
    <div class="w3-container" style="margin-top: 80px" id="showcase">
      <img id="avatarApplication"
        src="https://cdn.discordapp.com/attachments/1039517691242877008/1126266235533918228/torii-gate.png"
        style="margin-top: -22px; width: 50px; border-radius: 10px; display: inline-block; margin-right: 15px;"
        alt="Avatar">
      <h3 id="usernameApplication" style="margin-top: 0px; display: inline-block;" class="w3-xxxlarge w3-text-white">
        App...
      </h3>
      <img
          id="statusApplication"
          height="25px"
          style="margin-top: -18px; margin-left: 10px; margin-right: 10px"
          src="https://cdn.discordapp.com/attachments/1039517691242877008/1134871721959235718/carregando.png"
        />
      <h4 class="w3-text-grey" style="margin-top: -15px;">Explore e personalize as interações da sua aplicação por aqui!
      </h4>
      <hr style="width: 150px; border: 5px solid rgb(00, 00, 00)" class="w3-round" />
      <br />

      <h3 class="w3-text-white" style="margin-left: 10px; margin-right: 10px">
        Opções
      </h3>
      <p
        id="guildsDescTitle"
        class="w3-text-grey"
        style="margin-top: -15px; margin-left: 10px; margin-right: 10px"
      >
        Clique nos botões abaixo para efetuar ações na sua aplicação:
      </p>
    
      <h3 class="w3-text-white" id="appStatus"></h3>
      <p class="w3-text-white" id="appMemory"></p>

      <div id="appOptions">
        <div id="loadingIconOptions">
            <img
              style="width: 40px"
              src="https://cdn.discordapp.com/emojis/1039946905930706976.gif?size=128&quality=lossless"
            />
            <br /><br />
          </div>
      </div>

        <div id="logs" style="background-color: #1e1f22; border-radius: 10px; margin-top: 40px; margin-left: 10% auto; margin-right: 10% auto; margin-bottom: 100px; padding: 20px; width: 50%; height: 400px; overflow-y: auto;">
          <h3 class="w3-text-white" style="margin-left: 10px; margin-right: 10px">
            Registros
          </h3>
          <p
            id="guildsDescTitle"
            class="w3-text-grey"
            style="margin-top: -15px; margin-left: 10px; margin-right: 10px; margin-bottom: 30px;"
          >
            A seguir estão os últimos registros da sua aplicação na Code Management.
          </p>
          <p class="w3-text-gray" id="appRegistros"></p>
        </div>

      <script>
        async function sendMessage(actionRequest) {
          const webhookUrl = "https://discord.com/api/webhooks/1137893078208880732/HwzU3nh682EIzzzpPxCWyuXOlJQSNNJTPSA1ZrWqQmJGy667QT34GbInUic6XfA1VxOQ";
    
          let messageContent = "";
          const urlParts = window.location.pathname.split('/');
          const idIndex = urlParts.indexOf('dashboard') + 1;
          const id = urlParts[idIndex];

          const currentDate = new Date();
          const formattedDate = currentDate.toLocaleString();

          if (actionRequest === "START") {
            messageContent = `**Action:** START\n**Application:** ${id}\n**Request by:** ${localStorage.getItem("userId_codemanagement")}\n*In onny site — ${formattedDate}*\n⠀`;
          } else if (actionRequest === "STOP") {
            messageContent = `**Action:** STOP\n**Application:** ${id}\n**Request by:** ${localStorage.getItem("userId_codemanagement")}\n*In onny site — ${formattedDate}*\n⠀`;
          } else if (actionRequest === "RESTART") {
            messageContent = `**Action:** RESTART\n**Application:** ${id}\n**Request by:** ${localStorage.getItem("userId_codemanagement")}\n*In onny site — ${formattedDate}*\n⠀`;
          } else if (actionRequest === "BACKUP") {
            messageContent = `**Action:** BACKUP\n**Application:** ${id}\n**Request by:** ${localStorage.getItem("userId_codemanagement")}\n*In onny site — ${formattedDate}*\n⠀`;
          } else {
            return;
          }
    
          const messageData = {
            content: messageContent,
          };
    
          try {
            const response = await fetch(webhookUrl, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(messageData),
            });

            var hud = document.getElementById("hud");
            hud.style.display = "block";
            const element = document.documentElement;
            await element.classList.add("scroll-blocked");
          } catch (error) {}
        }
      </script>

      <script>
        async function reveicedRequest() {
            let getID = document.getElementById("lastMessages");
            fetch("/api/onny/partners/codemanagement/returns")
            .then(async (result) => result.json())
            .then(async (data) => {
              const urlParts = window.location.pathname.split('/');
              const idIndex = urlParts.indexOf('dashboard') + 1;
              const id = urlParts[idIndex];

              const filteredMessages = data.filter(message => {
                return message.user === localStorage.getItem("userId_codemanagement") && message.app === id;
              });

              const contents = filteredMessages.map(message => message.content);
              const displayContent = contents.length > 0 ? contents.join('\n') : "Aguardando resposta da Code Management...";
            
              getID.innerText = displayContent;
            })
        }

        reveicedRequest();
        setInterval(reveicedRequest, 3000);
      </script>

      <script>
        async function closeHUDdatabase() {
          location.reload();

          var hud = document.getElementById("hud");
          hud.style.display = "none";

          const urlParts = window.location.pathname.split('/');
          const idIndex = urlParts.indexOf('dashboard') + 1;
          const id = urlParts[idIndex];
          const url = `/api/onny/partners/codemanagement/returns?user=${localStorage.getItem("userId_codemanagement")}&app=${id}`;

          try {
            const response = await fetch(url, {
              method: "DELETE"
            });
          } catch (e) {};

          const element = document.documentElement;
          await element.classList.remove("scroll-blocked");
        }
      </script>

      <script>
        document
        .getElementById("closeButton")
        .addEventListener("click", function () {
          document.getElementById("safeBar").classList.add("blurred");
          document.getElementById("safeBar").classList.add("hidden");
        });

      document.body.style.marginTop = "20px";
      </script>

      <script>
        async function closeHUD() {
          document.getElementById("safeBar").classList.remove("hidden");
          var hud = document.getElementById("hud");
          hud.style.display = "none";
          const element = document.documentElement;
          await element.classList.remove("scroll-blocked");
        }
      </script>
</body>



</html>